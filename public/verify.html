<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Script Studio — Verification</title>
  <link rel="stylesheet" href="../source/css/styles.css" />
  <style>
    body { font-family: system-ui, sans-serif; padding: 16px; }
    .row { display: flex; gap: 16px; align-items: baseline; }
    .pass { color: #0b7; }
    .fail { color: #b00; }
    #log { white-space: pre-wrap; background:#f6f8fa; padding:12px; border-radius:8px; }
  </style>
</head>
<body>
  <h1>Script Studio — Verification</h1>
  <p>This runs zero-dependency checks against real modules in your browser.</p>

  <div id="summary" class="row"><strong>Summary:</strong> <span id="tally">Running…</span></div>
  <h3>Details</h3>
  <div id="log"></div>

  <script type="module">
    import { runAll } from '../source/js/verify.js';

    const logEl = document.getElementById('log');
    const tallyEl = document.getElementById('tally');

    const log = (line, cls='') => {
      const div = document.createElement('div');
      div.textContent = line;
      if (cls) div.className = cls;
      logEl.appendChild(div);
    };

    (async () => {
      try {
        const result = await runAll({
          trace: new URLSearchParams(location.search).get('trace') === '1',
          onPass: (msg) => log('✔ ' + msg, 'pass'),
          onFail: (msg) => log('✘ ' + msg, 'fail'),
          onInfo: (msg) => log('• ' + msg),
        });

        tallyEl.textContent = `${result.passed} passed, ${result.failed} failed, ${result.total} total`;
        tallyEl.className = result.failed ? 'fail' : 'pass';
        if (result.failed) console.error('Verification failed', result);
      } catch (e) {
        tallyEl.textContent = 'Harness crashed';
        tallyEl.className = 'fail';
        console.error(e);
        log('Harness error: ' + (e?.message || e), 'fail');
      }
    })();
  </script>
</body>
</html>